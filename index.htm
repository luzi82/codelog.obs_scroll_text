<html>
<head>
<meta charset="UTF-8">
<script>
window.onload=function(){
    console.log("NHVOYWWG");
    console.log(measureText("hello"));
    scrollElement0 = document.getElementById("scroll0");
    scrollElement1 = document.getElementById("scroll1");
    window.requestAnimationFrame(frameTick);
    
    displayText(
        [
            "HelloWorld",
            "Asdf",
            "IQCERBHS",
            "PAPFQZZR",
            "OAJMLPGP",
            "CLJELVLV",
            "XVVCDYOS",
            "QRYZUPPT",
            "EQVHPXQT",
            "PCXVATNN",
            "TJZJXCRA",
            "HFCTNPIE",
            "YSKWNVKP",
        ],
        10,600
    );
}

function displayText(txtList, sp, _screenWidth){
    var scrollElement = document.getElementById("scroll");
    scrollElement.innerHTML = "";
    scrollDataList = [];
    var totalWidth = 0;
    xMod = 0;
    screenWidth = _screenWidth;
    for(var j=0;(j<txtList.length)||(totalWidth<xMod+_screenWidth);++j){
        var i = j % txtList.length;
        var txt = txtList[i];
        var textWidth = measureText(txt);
        var element = document.createElement("div");
        var textNode = document.createTextNode(txt);
        element.appendChild(textNode);
        element.style.display = "none";
        element.style.position = "absolute";
        scrollElement.appendChild(element);
        scrollDataList.push({
            "offsetX0": totalWidth,
            "offsetX1": totalWidth+textWidth,
            "element":  element,
            "display":  false,
        });
        totalWidth += textWidth + sp;
        if(j<txtList.length){
            xMod = totalWidth;
        }
    }
    var j = 0;
    startMs = getNowMs();
    enableScroll = true;
}

function measureText(txt){
    var measureElement = document.getElementById("measure");
    measureElement.innerText = txt;
    var ret = measureElement.getBoundingClientRect().width;
    measureElement.innerText = "";
    return ret;
}

var enableScroll = false;
var xMod = 0;
var startMs = 0;
var scrollDataList = null;
var screenWidth = 0;
// offsetX0, offsetX1, element, display
function frameTick(){
    if(!enableScroll){
        window.requestAnimationFrame(frameTick);
        return;
    }
    var nowMs = getNowMs();
    
    var x = ((startMs-nowMs)*200)/1000;
    x %= xMod;
    for(var i=0;i<scrollDataList.length;++i){
        var scrollData = scrollDataList[i];
        var offsetX0 = scrollData["offsetX0"] + x;
        var offsetX1 = scrollData["offsetX1"] + x;
        var display = scrollData["display"];
        var shouldDisplay = (offsetX1>0)&&(offsetX0<screenWidth);
        var element = scrollData["element"];
        if((!display)&&(shouldDisplay)){
            element.style.left = offsetX0;
            element.style.display = "block";
            scrollData["display"] = true;
        }else if((display)&&(!shouldDisplay)){
            element.style.display = "none";
            scrollData["display"] = false;
        }else if ((display)&&(shouldDisplay)){
            element.style.left = offsetX0;
        }
    }
    
    window.requestAnimationFrame(frameTick);
}

function getNowMs(){
    return new Date().getTime();
}
</script>
</head>
<body>
<div>
<div id="scroll"></div>
</div>
<div style="position:absolute;visibility:hidden;">
<div id="measure"></div>
</div>
</body>
</html>
